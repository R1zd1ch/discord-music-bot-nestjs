# Discord Музыкальный Бот

## Описание

Этот проект представляет собой музыкального бота для Discord, который позволяет воспроизводить музыку из Яндекс.Музыки в голосовых каналах Discord. Бот разработан с использованием NestJS и предоставляет широкий функционал для управления музыкой.

## Основные возможности

- Воспроизведение музыки из Яндекс.Музыки
- Поиск треков по названию
- Воспроизведение треков по прямой ссылке
- Воспроизведение плейлистов и альбомов
- Управление очередью воспроизведения
- Создание и управление плейлистами
- Кэширование треков для оптимизации производительности
- Регулировка громкости

## Технологии

- **Backend**: NestJS
- **База данных**: PostgreSQL с Prisma ORM
- **Кэширование**: Redis
- **Discord API**: discord.js, necord
- **Аудио**: @discordjs/voice, discord-audio-stream, ffmpeg
- **Интеграция с Яндекс.Музыкой**: yandex-music-client

## Требования

- Node.js 20+
- PostgreSQL
- Redis (опционально, для кэширования)
- Discord Bot Token

## Установка и запуск

### Локальная установка

```bash
# Клонирование репозитория
git clone <repository-url>
cd music-discord-bot/music-bot

# Установка зависимостей
bun install

# Генерация Prisma клиента
bunx prisma generate

# Запуск миграций базы данных
bunx prisma migrate dev

# Запуск приложения в режиме разработки
bun run start:dev
```

### Запуск с использованием Docker

```bash
# Сборка и запуск контейнеров
docker-compose up -d
```

## Конфигурация

Создайте файл `.env` в корне проекта со следующими переменными:

```
# Настройки приложения
APP_PORT=3500
APP_HOST=discord_music_bot

# Discord
DISCORD_TOKEN=your_discord_token
DISCORD_CLIENT_ID=your_discord_client_id
DISCORD_GUILD_ID=your_discord_guild_id

# База данных
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=music_bot
POSTGRES_PORT=5432
POSTGRES_HOST=localhost
POSTGRES_URI=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Яндекс.Музыка
YANDEX_MUSIC_TOKEN=your_yandex_music_token
```

## Архитектура проекта

### Основные модули

- **discord-bot**: Основной модуль для взаимодействия с Discord API
  - **bot-handlers**: Обработчики команд и событий Discord
  - **player**: Сервисы для управления воспроизведением
  - **voice**: Сервисы для работы с голосовыми каналами
- **playlist**: Управление плейлистами
- **queue**: Управление очередью воспроизведения
- **track**: Управление треками
- **yandex-music**: Интеграция с API Яндекс.Музыки
- **prisma**: Взаимодействие с базой данных

### Ключевые сервисы

- **TrackResolverService**: Разрешение треков из различных источников
- **QueueProcessorService**: Обработка очереди воспроизведения
- **TrackCacheService**: Кэширование треков для оптимизации
- **YandexMusicService**: Взаимодействие с API Яндекс.Музыки
- **PlayerService**: Управление воспроизведением музыки
- **PlaylistService**: Управление плейлистами пользователей

## Команды бота

Бот поддерживает различные команды для управления музыкой в Discord:

- Воспроизведение треков и плейлистов
- Пауза/продолжение воспроизведения
- Пропуск треков
- Управление очередью
- Регулировка громкости
- Создание и управление плейлистами

## Разработка

### Запуск в режиме разработки

```bash
bun run start:dev
```

### Сборка проекта

```bash
bun run build
```

### Запуск билда

```bash
bun run dist/main.js
```

## Контейнеризация

Проект поддерживает Docker и Docker Compose для упрощения развертывания. Dockerfile настроен для использования Node.js 20 и включает все необходимые зависимости, включая ffmpeg для обработки аудио.

## Кэширование

Бот использует систему кэширования для оптимизации производительности:

- Кэширование результатов поиска
- Кэширование информации о треках
- Кэширование аудиофайлов

## Лицензия

Проект распространяется под лицензией MIT.

## Автор

R1zdd
